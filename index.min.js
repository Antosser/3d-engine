/***************************************

COPYRIGHT!!! https://github.com/Antosser

***************************************/

var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),h=window.innerHeight,h2=window.innerHeight/2,w=window.innerWidth,w2=window.innerWidth/2,keysPressed=new Set,size=Math.min(w,h),size2=Math.min(w,h)/2;canvas.height=size,canvas.width=size;var logKey=e=>{keysPressed.add(e.code)},logKey2=e=>{keysPressed.delete(e.code)};document.addEventListener("keydown",logKey),document.addEventListener("keyup",logKey2);var player={pos:{x:0,y:0,z:-5},ang:{x:0,y:0,z:0},fov:100},line=(e,a,t,n)=>{ctx.beginPath(),ctx.moveTo(e,a),ctx.lineTo(t,n),ctx.stroke()},circle=(e,a,t,n,y)=>{ctx.beginPath(),ctx.arc(e,a,t,n,3.1415*y),ctx.stroke()},getPoint2d=(e,a,t)=>(e-=player.pos.x,a-=player.pos.y,t-=player.pos.z,[e,t]=[e*Math.cos(3.1415*player.ang.x/180)-t*Math.sin(3.1415*player.ang.x/180),e*Math.sin(3.1415*player.ang.x/180)+t*Math.cos(3.1415*player.ang.x/180)],[t,a]=[t*Math.cos(3.1415*-player.ang.y/180)-a*Math.sin(3.1415*-player.ang.y/180),t*Math.sin(3.1415*-player.ang.y/180)+a*Math.cos(3.1415*-player.ang.y/180)],[e,a]=[e*Math.cos(3.1415*-player.ang.z/180)-a*Math.sin(3.1415*-player.ang.z/180),e*Math.sin(3.1415*-player.ang.z/180)+a*Math.cos(3.1415*-player.ang.z/180)],cx=180*Math.atan2(e,Math.sqrt(a*a+t*t))/3.1415/player.fov,cy=180*Math.atan2(a,Math.sqrt(e*e+t*t))/3.1415/player.fov,cx*=h,cy*=h,[cx+size2,cy+size2]),drawPoint3d=(e,a,t,n)=>{[cx,cy]=getPoint2d(e,a,t),1==n&&(n=50/Math.sqrt((e-player.pos.x)**2+(a-player.pos.y)**2+(t-player.pos.z)**2)),ctx.fillRect(cx-n/2,cy-n/2,n,n)},drawLine3d=(e,a,t,n,y,c)=>{[cx1,cy1]=getPoint2d(e,a,t),[cx2,cy2]=getPoint2d(n,y,c),line(cx1,cy1,cx2,cy2)};

var interval = setInterval(() => {
	ctx.clearRect(0, 0, canvas.width, canvas.height);

	drawPoint3d(-1, -1, -1, true);
	drawPoint3d(1, -1, -1, true);
	drawPoint3d(-1, 1, -1, true);
	drawPoint3d(1, 1, -1, true);
	drawPoint3d(-1, -1, 1, true);
	drawPoint3d(1, -1, 1, true);
	drawPoint3d(-1, 1, 1, true);
	drawPoint3d(1, 1, 1, true);

	drawLine3d(	-1,	-1,	-1,	1,	-1,	-1,	);
	drawLine3d(	-1,	-1,	-1,	-1,	1,	-1,	);
	drawLine3d(	-1,	-1,	-1,	-1,	-1,	1,	);
	drawLine3d(	1,	-1,	1,	-1,	-1,	1,	);
	drawLine3d(	1,	-1,	1,	1,	1,	1,	);
	drawLine3d(	1,	-1,	1,	1,	-1,	-1,	);
	drawLine3d(	-1,	-1,	1,	-1,	1,	1,	);
	drawLine3d(	1,	-1,	-1,	1,	1,	-1,	);
	drawLine3d(	-1,	1,	-1,	-1,	1,	1,	);
	drawLine3d(	-1,	1,	-1,	1,	1,	-1,	);
	drawLine3d(	1,	1,	1,	-1,	1,	1,	);
	drawLine3d(	1,	1,	1,	1,	1,	-1,	);

	//console.log(keysPressed);

	if (keysPressed.has("KeyA") == true) {
		player.pos.x -= 0.1;
	}
	if (keysPressed.has("KeyD") == true) {
		player.pos.x += 0.1;
	}
	if (keysPressed.has("KeyW") == true) {
		player.pos.y -= 0.1;
	}
	if (keysPressed.has("KeyS") == true) {
		player.pos.y += 0.1;
	}
	if (keysPressed.has("ArrowLeft") == true) {
		player.ang.x -= 1;
	}
	if (keysPressed.has("ArrowRight") == true) {
		player.ang.x += 1;
	}
	if (keysPressed.has("ArrowUp") == true) {
		player.ang.y -= 1;
	}
	if (keysPressed.has("ArrowDown") == true) {
		player.ang.y += 1;
	}

}, 35);