/***************************************

COPYRIGHT!!! https://github.com/Antosser

***************************************/

var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),h=window.innerHeight,h2=window.innerHeight/2,w=window.innerWidth,w2=window.innerWidth/2,keysPressed=new Set,size=Math.min(w,h),size2=Math.min(w,h)/2;canvas.height=size,canvas.width=size;var logKey=a=>{keysPressed.add(a.code)},logKey2=a=>{keysPressed.delete(a.code)};document.addEventListener("keydown",logKey),document.addEventListener("keyup",logKey2);var player={pos:{x:0,y:0,z:-5},ang:{x:0,y:0,z:0},fov:100},line=(a,e,n,t)=>{ctx.beginPath(),ctx.moveTo(a,e),ctx.lineTo(n,t),ctx.stroke()},circle=(a,e,n,t,d)=>{ctx.beginPath(),ctx.arc(a,e,n,t,3.1415*d),ctx.stroke()},getPoint2d=(a,e,n)=>(a-=player.pos.x,e-=player.pos.y,n-=player.pos.z,[a,n]=[a*Math.cos(3.1415*player.ang.x/180)-n*Math.sin(3.1415*player.ang.x/180),a*Math.sin(3.1415*player.ang.x/180)+n*Math.cos(3.1415*player.ang.x/180)],[n,e]=[n*Math.cos(3.1415*-player.ang.y/180)-e*Math.sin(3.1415*-player.ang.y/180),n*Math.sin(3.1415*-player.ang.y/180)+e*Math.cos(3.1415*-player.ang.y/180)],[a,e]=[a*Math.cos(3.1415*-player.ang.z/180)-e*Math.sin(3.1415*-player.ang.z/180),a*Math.sin(3.1415*-player.ang.z/180)+e*Math.cos(3.1415*-player.ang.z/180)],cx=180*Math.atan2(a,Math.sqrt(e*e+n*n))/3.1415/player.fov,cy=180*Math.atan2(e,Math.sqrt(a*a+n*n))/3.1415/player.fov,cx*=h,cy*=h,[cx+size2,cy+size2]),drawPoint3d=(a,e,n)=>{[cx,cy]=getPoint2d(a,e,n),s=50/Math.sqrt((a-player.pos.x)**2+(e-player.pos.y)**2+(n-player.pos.z)**2),ctx.fillRect(cx-s/2,cy-s/2,s,s)},drawLine3d=(a,e,n,t,d,i)=>{[cx1,cy1]=getPoint2d(a,e,n),[cx2,cy2]=getPoint2d(t,d,i),line(cx1,cy1,cx2,cy2)},drawCube=(a,e,n,t,d,i,r,s)=>{r&&(drawPoint3d(a,e,i),drawPoint3d(a,e,n),drawPoint3d(a,d,i),drawPoint3d(a,d,n),drawPoint3d(t,e,i),drawPoint3d(t,e,n),drawPoint3d(t,d,i),drawPoint3d(t,d,n)),s&&(drawLine3d(a,e,n,t,e,n),drawLine3d(a,e,n,a,d,n),drawLine3d(a,e,n,a,e,i),drawLine3d(t,e,i,a,e,i),drawLine3d(t,e,i,t,d,i),drawLine3d(t,e,i,t,e,n),drawLine3d(a,e,i,a,d,i),drawLine3d(t,e,n,t,d,n),drawLine3d(a,d,n,a,d,i),drawLine3d(a,d,n,t,d,n),drawLine3d(t,d,i,a,d,i),drawLine3d(t,d,i,t,d,n))};var fps = 30;

var loop = () => {
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	drawCube(-1, -1, -1, 1, 1, 1, true, true)

	//console.log(keysPressed);

	if (keysPressed.has("KeyA") == true) {
		player.pos.x -= 0.1;
	}
	if (keysPressed.has("KeyD") == true) {
		player.pos.x += 0.1;
	}
	if (keysPressed.has("KeyW") == true) {
		player.pos.y -= 0.1;
	}
	if (keysPressed.has("KeyS") == true) {
		player.pos.y += 0.1;
	}
	if (keysPressed.has("ArrowLeft") == true) {
		player.ang.x -= 1;
	}
	if (keysPressed.has("ArrowRight") == true) {
		player.ang.x += 1;
	}
	if (keysPressed.has("ArrowUp") == true) {
		player.ang.y -= 1;
	}
	if (keysPressed.has("ArrowDown") == true) {
		player.ang.y += 1;
	}

}

setInterval(loop, 1000 / fps)